local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:WaitForChild("HumanoidRootPart")

local teleportEnabled = true

local function createSphere()
    local sphere = Instance.new("Part")
    sphere.Name = "TeleportSphere"
    sphere.Shape = Enum.PartType.Ball
    sphere.Size = Vector3.new(20, 20, 20)
    sphere.Position = rootPart.Position
    sphere.Anchored = false
    sphere.CanCollide = false
    sphere.Massless = false
    sphere.Transparency = 0.5
    sphere.Color = Color3.fromRGB(128, 0, 255)
    sphere.Material = Enum.Material.ForceField
    sphere.Parent = workspace

    local sphereMesh = Instance.new("SpecialMesh")
    sphereMesh.MeshType = Enum.MeshType.Sphere
    sphereMesh.Scale = Vector3.new(1, 1, 1)
    sphereMesh.Parent = sphere

    return sphere
end

local teleportSphere = createSphere()

game:GetService("RunService").RenderStepped:Connect(function()
    teleportSphere.CFrame = rootPart.CFrame
end)

player:GetMouse().KeyDown:Connect(function(key)
    if key:lower() == "r" then
        teleportEnabled = not teleportEnabled
        teleportSphere.Transparency = teleportEnabled and 0.5 or 1
    end
end)

local playersInSphere = {}

spawn(function()
    while teleportSphere do
        if teleportEnabled and character:FindFirstChild("Highlight") then
            for _, otherPlayer in pairs(game.Players:GetPlayers()) do
                if otherPlayer == player then continue end

                local otherChar = otherPlayer.Character
                if not otherChar then continue end

                local otherHRP = otherChar:FindFirstChild("HumanoidRootPart")
                if not otherHRP then continue end

                local distance = (teleportSphere.Position - otherHRP.Position).Magnitude
                local radius = teleportSphere.Size.X / 2

                if distance <= radius then
                    otherHRP.CFrame = rootPart.CFrame * CFrame.new(0, 0, 0)
                end
            end
        end

        wait(0.1)
    end
end)

character:WaitForChild("Humanoid").Died:Connect(function()
    if teleportSphere then
        teleportSphere:Destroy()
    end
    teleportEnabled = false
    playersInSphere = nil
    setfenv(debug.getregistry()[1], {})
end)
